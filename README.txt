Based on http://pivotallabs.com/swapping-javascript-spec-implementation-rubymine/